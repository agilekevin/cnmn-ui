<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>cnmn - Word Chain Puzzle</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Libre Baskerville', Georgia, serif;
    }
    #root {
      width: 100%;
      min-height: 100vh;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React & ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Your React Component -->
  <script type="text/babel">
    const { useState, useRef } = React;

    // ============================================
    // PUZZLE DATA - Update this for each new puzzle
    // ============================================
    // TO RELEASE A NEW PUZZLE:
    // 1. Update 'number' (increment by 1)
    // 2. Update 'date' (day name or full date)
    // 3. Replace all 6 'links' with new puzzle chain
    // 4. Commit and push to deploy
    // ============================================

    const CHAIN_DATA = {
      number: 47,
      date: "Wednesday",
      links: [
        {
          category: "Ocean animal",
          options: ["shrk", "cml", "frg", "lbrtr"],
          answer: "shrk",
          decoded: "SHARK",
          emoji: "ðŸ¦ˆ",
          bridge: "Has sharp teeth..."
        },
        {
          category: "Dentist's tool",
          options: ["drl", "hmrtn", "skrw", "pncl"],
          answer: "drl",
          decoded: "DRILL",
          emoji: "ðŸ› ï¸",
          bridge: "Makes holes..."
        },
        {
          category: "Oil rig equipment",
          options: ["drik", "pump", "fns", "bskt"],
          answer: "drik",
          decoded: "DERRICK",
          emoji: "ðŸ—¼",
          bridge: "Tall tower..."
        },
        {
          category: "Parisian landmark",
          options: ["efl", "lvr", "notr", "mprs"],
          answer: "efl",
          decoded: "EIFFEL",
          emoji: "ðŸ—¼",
          bridge: "Made of iron..."
        },
        {
          category: "Golf club type",
          options: ["irn", "wdg", "putr", "drvr"],
          answer: "irn",
          decoded: "IRON",
          emoji: "â›³",
          bridge: "Pressed flat..."
        },
        {
          category: "Dress shirt part",
          options: ["colr", "slf", "cuf", "bttn"],
          answer: "colr",
          decoded: "COLLAR",
          emoji: "ðŸ‘”",
          bridge: null
        }
      ]
    };

    // Audio feedback using Web Audio API
    const useAudio = () => {
      const audioContextRef = useRef(null);

      const getContext = () => {
        if (!audioContextRef.current) {
          audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
        }
        return audioContextRef.current;
      };

      const playCorrect = () => {
        try {
          const ctx = getContext();
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();

          osc.connect(gain);
          gain.connect(ctx.destination);

          osc.frequency.setValueAtTime(523.25, ctx.currentTime);
          osc.frequency.setValueAtTime(659.25, ctx.currentTime + 0.1);
          osc.frequency.setValueAtTime(783.99, ctx.currentTime + 0.2);

          gain.gain.setValueAtTime(0.3, ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);

          osc.start(ctx.currentTime);
          osc.stop(ctx.currentTime + 0.4);
        } catch (e) {
          console.log('Audio not available');
        }
      };

      const playWrong = () => {
        try {
          const ctx = getContext();
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();

          osc.connect(gain);
          gain.connect(ctx.destination);

          osc.frequency.setValueAtTime(200, ctx.currentTime);
          osc.frequency.setValueAtTime(150, ctx.currentTime + 0.1);

          gain.gain.setValueAtTime(0.3, ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);

          osc.start(ctx.currentTime);
          osc.stop(ctx.currentTime + 0.2);
        } catch (e) {
          console.log('Audio not available');
        }
      };

      const playComplete = () => {
        try {
          const ctx = getContext();
          const notes = [523.25, 659.25, 783.99, 1046.50];

          notes.forEach((freq, i) => {
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();

            osc.connect(gain);
            gain.connect(ctx.destination);

            osc.frequency.setValueAtTime(freq, ctx.currentTime + i * 0.15);
            gain.gain.setValueAtTime(0.3, ctx.currentTime + i * 0.15);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.15 + 0.3);

            osc.start(ctx.currentTime + i * 0.15);
            osc.stop(ctx.currentTime + i * 0.15 + 0.3);
          });
        } catch (e) {
          console.log('Audio not available');
        }
      };

      return { playCorrect, playWrong, playComplete };
    };

    const formatTime = (seconds) => {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    };

    function CNMN() {
      const [currentLink, setCurrentLink] = useState(0);
      const [eliminated, setEliminated] = useState([]);
      const [misses, setMisses] = useState(0);
      const [missedLinks, setMissedLinks] = useState([]);
      const [solved, setSolved] = useState(false);
      const [showReveal, setShowReveal] = useState(false);
      const [startTime] = useState(Date.now());
      const [endTime, setEndTime] = useState(null);
      const [shakeOption, setShakeOption] = useState(null);
      const [copied, setCopied] = useState(false);
      const [solvedLinks, setSolvedLinks] = useState([]);

      const { playCorrect, playWrong, playComplete } = useAudio();

      const chain = CHAIN_DATA;
      const link = chain.links[currentLink];

      const handleGuess = (option) => {
        if (eliminated.includes(option) || showReveal) return;

        if (option === link.answer) {
          playCorrect();
          setSolvedLinks([...solvedLinks, currentLink]);
          setShowReveal(true);

          if (currentLink < chain.links.length - 1) {
            setTimeout(() => {
              setShowReveal(false);
              setCurrentLink(currentLink + 1);
              setEliminated([]);
            }, 2000);
          } else {
            setTimeout(() => {
              setEndTime(Date.now());
              setSolved(true);
              playComplete();
            }, 2000);
          }
        } else {
          playWrong();
          setShakeOption(option);
          setEliminated([...eliminated, option]);
          setMisses(misses + 1);
          if (!missedLinks.includes(currentLink)) {
            setMissedLinks([...missedLinks, currentLink]);
          }
          setTimeout(() => setShakeOption(null), 300);
        }
      };

      const getShareText = () => {
        const elapsed = Math.floor((endTime - startTime) / 1000);
        const chainVisual = chain.links.map((_, i) =>
          missedLinks.includes(i) ? 'â—‹' : 'â—'
        ).join('');

        return `cnmn #${chain.number} ðŸ”—\n${chainVisual}\n${formatTime(elapsed)} | ${misses} missed`;
      };

      const handleShare = async () => {
        const text = getShareText();
        try {
          await navigator.clipboard.writeText(text);
          setCopied(true);
          setTimeout(() => setCopied(false), 2000);
        } catch (e) {
          console.log('Copy failed');
        }
      };

      const elapsed = solved
        ? Math.floor((endTime - startTime) / 1000)
        : Math.floor((Date.now() - startTime) / 1000);

      // Results screen
      if (solved) {
        return (
          <div style={styles.container}>
            <div style={styles.resultsCard}>
              <div style={styles.resultsHeader}>
                <span style={styles.logo}>cnmn</span>
                <span style={styles.puzzleNum}>#{chain.number}</span>
              </div>

              <div style={styles.chainImagesComplete}>
                {chain.links.map((l, i) => (
                  <React.Fragment key={i}>
                    <div
                      className="chainImageWrapperSmall"
                      style={{
                        ...styles.chainImageWrapperSmall,
                        ...styles.emojiContainer,
                        borderColor: missedLinks.includes(i) ? '#d4a574' : '#6b3410'
                      }}
                    >
                      <span style={styles.emojiSmall}>{l.emoji}</span>
                    </div>
                    {i < chain.links.length - 1 && (
                      <div style={styles.chainConnector}>â†’</div>
                    )}
                  </React.Fragment>
                ))}
              </div>

              <div style={styles.statsRow}>
                <div style={styles.stat}>
                  <div style={styles.statValue}>{formatTime(elapsed)}</div>
                  <div style={styles.statLabel}>time</div>
                </div>
                <div style={styles.statDivider} />
                <div style={styles.stat}>
                  <div style={styles.statValue}>{misses}</div>
                  <div style={styles.statLabel}>missed</div>
                </div>
              </div>

              <button style={styles.shareButton} onClick={handleShare}>
                {copied ? 'Copied!' : 'Share'}
              </button>

              <div style={styles.chainReview}>
                <div style={styles.reviewTitle}>The Chain</div>
                <div style={styles.reviewStartCategory}>{chain.links[0].category}</div>
                {chain.links.map((l, i) => (
                  <div key={i} style={styles.reviewItem}>
                    <span style={styles.reviewAnswer}>{l.decoded}</span>
                    {l.bridge && <span style={styles.reviewBridge}>{l.bridge}</span>}
                  </div>
                ))}
              </div>
            </div>
          </div>
        );
      }

      // Game screen
      return (
        <div style={styles.container}>
          <div style={styles.header}>
            <span style={styles.logo}>cnmn</span>
            <span style={styles.puzzleInfo}>#{chain.number} Â· {chain.date}</span>
          </div>

          {/* Image chain progress */}
          <div style={styles.imageChain}>
            {solvedLinks.map((linkIdx) => (
              <React.Fragment key={linkIdx}>
                <div className="chainImageWrapperTiny" style={{...styles.chainImageWrapperTiny, ...styles.emojiContainer}}>
                  <span style={styles.emojiTiny}>{chain.links[linkIdx].emoji}</span>
                </div>
                <div style={styles.chainConnectorTiny}>â†’</div>
              </React.Fragment>
            ))}
            {solvedLinks.length < chain.links.length && (
              <div style={styles.chainPlaceholder}>?</div>
            )}
          </div>

          {/* Main content area */}
          <div style={styles.mainArea}>
            {showReveal ? (
              <div style={styles.revealContainer}>
                <div style={{...styles.imageReveal, ...styles.emojiContainer}}>
                  <span style={styles.emojiLarge}>{link.emoji}</span>
                </div>
                <div style={styles.revealWord}>{link.decoded}</div>
              </div>
            ) : (
              <>
                <div style={styles.categoryContainer}>
                  {currentLink === 0 ? (
                    <>
                      <div style={styles.categoryLabel}>Find the</div>
                      <div style={styles.category}>{link.category}</div>
                    </>
                  ) : (
                    <>
                      <div style={{...styles.previousEmojiContainer, ...styles.emojiContainer}}>
                        <span style={styles.emojiMedium}>{chain.links[currentLink - 1].emoji}</span>
                      </div>
                      <div style={styles.previousAnswer}>
                        {chain.links[currentLink - 1].decoded}
                      </div>
                    </>
                  )}
                </div>

                <div style={styles.options}>
                  {link.options.map((option) => {
                    const isEliminated = eliminated.includes(option);
                    const isShaking = shakeOption === option;

                    return (
                      <button
                        key={option}
                        style={{
                          ...styles.option,
                          ...(isEliminated ? styles.optionEliminated : {}),
                          ...(isShaking ? styles.optionShake : {})
                        }}
                        onClick={() => handleGuess(option)}
                        disabled={isEliminated || showReveal}
                      >
                        {option}
                      </button>
                    );
                  })}
                </div>
              </>
            )}
          </div>

          <div style={styles.footer}>
            <span style={styles.missCount}>
              {misses > 0 ? `${misses} missed` : ''}
            </span>
          </div>
        </div>
      );
    }

    const styles = {
      container: {
        minHeight: '100vh',
        background: 'linear-gradient(165deg, #fdfbf7 0%, #f5e6d3 50%, #ecdbc8 100%)',
        fontFamily: "'Libre Baskerville', Georgia, serif",
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'center',
        padding: '32px 20px',
        boxSizing: 'border-box',
      },
      header: {
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'baseline',
        width: '100%',
        maxWidth: '420px',
        marginBottom: '24px',
      },
      logo: {
        fontSize: '36px',
        fontWeight: '700',
        color: '#6b3410',
        letterSpacing: '6px',
        textShadow: '0 2px 4px rgba(107, 52, 16, 0.1)',
      },
      puzzleInfo: {
        fontSize: '13px',
        color: '#8b6340',
        letterSpacing: '0.5px',
      },

      // Image chain at top
      imageChain: {
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        gap: '6px',
        marginBottom: '32px',
        minHeight: '52px',
        flexWrap: 'wrap',
      },
      chainImageWrapperTiny: {
        width: '44px',
        height: '44px',
        borderRadius: '10px',
        overflow: 'hidden',
        border: '2.5px solid #6b3410',
        boxShadow: '0 3px 12px rgba(107, 52, 16, 0.25), 0 1px 4px rgba(107, 52, 16, 0.15)',
        transition: 'transform 0.2s ease',
      },
      emojiTiny: {
        fontSize: '24px',
        lineHeight: 1,
      },
      chainConnectorTiny: {
        color: '#b8956d',
        fontSize: '18px',
        fontWeight: '600',
        opacity: '0.8',
      },
      chainPlaceholder: {
        width: '44px',
        height: '44px',
        borderRadius: '10px',
        border: '2.5px dashed #c4a574',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        color: '#c4a574',
        fontSize: '22px',
        fontWeight: '700',
        backgroundColor: 'rgba(255, 255, 255, 0.4)',
      },

      // Main area
      mainArea: {
        flex: 1,
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'center',
        justifyContent: 'center',
        width: '100%',
        maxWidth: '420px',
      },

      // Reveal animation
      revealContainer: {
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'center',
        animation: 'popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
      },
      imageReveal: {
        width: '220px',
        height: '220px',
        borderRadius: '20px',
        overflow: 'hidden',
        border: '4px solid #6b3410',
        boxShadow: '0 12px 40px rgba(107, 52, 16, 0.35), 0 4px 12px rgba(107, 52, 16, 0.2)',
        marginBottom: '20px',
      },
      emojiLarge: {
        fontSize: '120px',
        lineHeight: 1,
        animation: 'scaleIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
      },
      revealWord: {
        fontSize: '32px',
        fontWeight: '700',
        color: '#6b3410',
        letterSpacing: '4px',
        fontFamily: "'IBM Plex Mono', monospace",
        textShadow: '0 2px 8px rgba(107, 52, 16, 0.1)',
        animation: 'fadeInUp 0.5s ease 0.2s backwards',
      },

      categoryContainer: {
        textAlign: 'center',
        marginBottom: '48px',
        minHeight: '90px',
        display: 'flex',
        flexDirection: 'column',
        justifyContent: 'center',
        alignItems: 'center',
        animation: 'fadeIn 0.4s ease',
        gap: '16px',
      },
      categoryLabel: {
        fontSize: '13px',
        color: '#8b6340',
        marginBottom: '10px',
        textTransform: 'uppercase',
        letterSpacing: '2.5px',
        fontWeight: '600',
      },
      category: {
        fontSize: '36px',
        fontWeight: '400',
        color: '#6b3410',
        fontStyle: 'italic',
        lineHeight: '1.3',
      },
      previousEmojiContainer: {
        width: '100px',
        height: '100px',
        borderRadius: '16px',
        border: '3px solid #6b3410',
        boxShadow: '0 4px 16px rgba(107, 52, 16, 0.25)',
      },
      emojiMedium: {
        fontSize: '60px',
        lineHeight: 1,
      },
      previousAnswer: {
        fontSize: '36px',
        fontWeight: '700',
        color: '#6b3410',
        letterSpacing: '4px',
        fontFamily: "'IBM Plex Mono', monospace",
        textShadow: '0 2px 4px rgba(107, 52, 16, 0.08)',
      },
      options: {
        display: 'grid',
        gridTemplateColumns: '1fr 1fr',
        gap: '14px',
        width: '100%',
        maxWidth: '420px',
      },
      option: {
        padding: '24px 20px',
        fontSize: '24px',
        fontFamily: "'IBM Plex Mono', monospace",
        fontWeight: '600',
        backgroundColor: '#ffffff',
        border: '3px solid #6b3410',
        borderRadius: '14px',
        cursor: 'pointer',
        transition: 'all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
        color: '#6b3410',
        letterSpacing: '1.5px',
        boxShadow: '0 5px 0 #8b4513, 0 8px 20px rgba(107, 52, 16, 0.15)',
        position: 'relative',
      },
      optionEliminated: {
        backgroundColor: '#f0e4d3',
        borderColor: '#c4a574',
        color: '#b8956d',
        cursor: 'default',
        boxShadow: 'none',
        transform: 'translateY(5px)',
        opacity: '0.5',
      },
      optionShake: {
        animation: 'shake 0.35s ease',
      },
      footer: {
        marginTop: '40px',
        height: '28px',
      },
      missCount: {
        fontSize: '14px',
        color: '#8b6340',
        letterSpacing: '0.5px',
      },

      // Results styles
      resultsCard: {
        width: '100%',
        maxWidth: '420px',
        textAlign: 'center',
        animation: 'fadeIn 0.5s ease',
      },
      resultsHeader: {
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'baseline',
        gap: '14px',
        marginBottom: '28px',
      },
      puzzleNum: {
        fontSize: '18px',
        color: '#8b6340',
        letterSpacing: '0.5px',
      },
      chainImagesComplete: {
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        gap: '8px',
        marginBottom: '40px',
        flexWrap: 'wrap',
        padding: '20px',
        backgroundColor: 'rgba(255, 255, 255, 0.5)',
        borderRadius: '16px',
      },
      chainImageWrapperSmall: {
        width: '52px',
        height: '52px',
        borderRadius: '12px',
        overflow: 'hidden',
        border: '3px solid',
        boxShadow: '0 3px 12px rgba(107, 52, 16, 0.25)',
        transition: 'transform 0.2s ease',
      },
      emojiContainer: {
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        backgroundColor: '#ffffff',
      },
      emojiSmall: {
        fontSize: '28px',
        lineHeight: 1,
      },
      chainConnector: {
        color: '#b8956d',
        fontSize: '20px',
        fontWeight: '700',
        opacity: '0.8',
      },
      statsRow: {
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'center',
        gap: '40px',
        marginBottom: '36px',
      },
      stat: {
        textAlign: 'center',
      },
      statValue: {
        fontSize: '40px',
        fontWeight: '700',
        color: '#6b3410',
        fontFamily: "'IBM Plex Mono', monospace",
        textShadow: '0 2px 4px rgba(107, 52, 16, 0.1)',
      },
      statLabel: {
        fontSize: '11px',
        color: '#8b6340',
        textTransform: 'uppercase',
        letterSpacing: '2.5px',
        marginTop: '6px',
        fontWeight: '600',
      },
      statDivider: {
        width: '2px',
        height: '56px',
        backgroundColor: '#c4a574',
        borderRadius: '2px',
      },
      shareButton: {
        padding: '18px 56px',
        fontSize: '15px',
        fontFamily: "'Libre Baskerville', Georgia, serif",
        fontWeight: '700',
        backgroundColor: '#6b3410',
        color: '#fdfbf7',
        border: 'none',
        borderRadius: '14px',
        cursor: 'pointer',
        letterSpacing: '3px',
        textTransform: 'uppercase',
        marginBottom: '56px',
        boxShadow: '0 5px 0 #4a2309, 0 8px 24px rgba(107, 52, 16, 0.3)',
        transition: 'all 0.2s ease',
      },
      chainReview: {
        textAlign: 'left',
        padding: '28px',
        backgroundColor: 'rgba(255, 255, 255, 0.9)',
        borderRadius: '18px',
        border: '2px solid #c4a574',
        boxShadow: '0 6px 24px rgba(107, 52, 16, 0.12)',
      },
      reviewTitle: {
        fontSize: '11px',
        color: '#8b6340',
        textTransform: 'uppercase',
        letterSpacing: '2.5px',
        marginBottom: '18px',
        fontWeight: '700',
      },
      reviewStartCategory: {
        fontSize: '13px',
        color: '#8b6340',
        fontStyle: 'italic',
        marginBottom: '12px',
        opacity: '0.9',
      },
      reviewItem: {
        marginBottom: '16px',
      },
      reviewAnswer: {
        color: '#6b3410',
        fontWeight: '600',
        fontFamily: "'IBM Plex Mono', monospace",
        letterSpacing: '1.5px',
        fontSize: '17px',
        display: 'block',
      },
      reviewBridge: {
        color: '#8b6340',
        fontSize: '13px',
        fontStyle: 'italic',
        display: 'block',
        marginTop: '4px',
        paddingLeft: '12px',
        borderLeft: '3px solid #c4a574',
        opacity: '0.85',
      },
    };

    // Add keyframe animations via style tag
    const styleSheet = document.createElement('style');
    styleSheet.textContent = `
      @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap');

      @keyframes shake {
        0%, 100% { transform: translateX(0) translateY(5px); }
        20% { transform: translateX(-10px) translateY(5px); }
        40% { transform: translateX(10px) translateY(5px); }
        60% { transform: translateX(-6px) translateY(5px); }
        80% { transform: translateX(6px) translateY(5px); }
      }

      @keyframes popIn {
        0% {
          opacity: 0;
          transform: scale(0.4);
        }
        60% {
          transform: scale(1.05);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes scaleIn {
        0% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(15px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      * {
        -webkit-tap-highlight-color: transparent;
      }

      button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 7px 0 #8b4513, 0 12px 28px rgba(107, 52, 16, 0.25) !important;
      }

      button:active:not(:disabled) {
        transform: translateY(5px);
        box-shadow: none !important;
      }

      .chainImageWrapperSmall:hover,
      .chainImageWrapperTiny:hover {
        transform: scale(1.1);
      }
    `;
    document.head.appendChild(styleSheet);

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<CNMN />);
  </script>
</body>
</html>
